<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RozgaarIn | Savitri Bridge Professional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { 
            --primary: #3b82f6; --success: #10b981; --danger: #ef4444; --dark-bg: #0f172a; 
            --slate-grey: #1e293b; --text-main: #f8fafc; --glass: rgba(30, 41, 59, 0.75);
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%); 
            color: var(--text-main); margin: 0; min-height: 100vh; 
            overflow-x: hidden;
        }
        .container { max-width: 460px; margin: auto; padding: 20px; }
        .luxury-card { 
            background: var(--glass); backdrop-filter: blur(25px); padding: 25px; 
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); 
        }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 10px; font-weight: 700; margin-bottom: 5px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea { 
            width: 100%; padding: 12px; background: rgba(0,0,0,0.25); 
            border: 1px solid rgba(255,255,255,0.1); color: #fff; 
            border-radius: 15px; box-sizing: border-box; outline: none; font-family: inherit;
        }
        .btn-main { 
            width: 100%; padding: 15px; background: var(--primary); 
            color: white; border: none; border-radius: 15px; 
            font-weight: 800; cursor: pointer; margin-top: 10px; 
            transition: 0.3s;
        }
        .tab-box { display: flex; background: rgba(0,0,0,0.3); border-radius: 15px; padding: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; cursor: pointer; color: #94a3b8; background: transparent; font-weight: 600; }
        .active-tab { background: var(--slate-grey); color: #fff; }
        .candidate-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; margin-top: 15px; border-left: 4px solid var(--primary); animation: fadeInUp 0.6s ease; }
        #intro-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .id-box { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 30px; border-radius: 25px; border: 2px solid var(--primary); margin-bottom: 20px; text-align: center;}
        .logout-btn { background: var(--danger); padding: 5px 12px; border-radius: 10px; color: white; border: none; font-size: 10px; cursor: pointer; float: right; }
    </style>
</head>
<body>

<div id="intro-overlay">
    <div style="font-size: 2.5rem; letter-spacing: 5px; background: linear-gradient(to right, #3b82f6, #10b981); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" class="animate__animated animate__zoomIn">ROZGAAR IN</div>
</div>

<div class="container" id="main-content" style="display:none;">
    <div class="luxury-card animate__animated animate__fadeInUp">
        <div id="brand-header" style="text-align: center; margin-bottom: 20px;">
            <h1 style="margin:0; font-size: 26px;">Rozgaar<span style="color:var(--success)">In</span></h1>
            <p style="font-size:10px; color:#94a3b8;">SAVITRI ELECTRONICS & FURNITURE PROJECT</p>
        </div>

        <div class="tab-box" id="tabNav">
            <button class="tab-btn active-tab" id="t1" onclick="switchTab('seeker')">Staff Baniye</button>
            <button class="tab-btn" id="t2" onclick="switchTab('employer')">Staff Dhoondhein</button>
            <button class="tab-btn" id="t3" onclick="switchTab('dash')">Dashboard</button>
        </div>

        <div id="seekerSection">
            <div class="input-group"><label>Pura Naam</label><input type="text" id="sName" placeholder="Full Name"></div>
            <div class="input-group"><label>Hunar (Skill)</label><input type="text" id="sSkill" placeholder="e.g. Sales, Driver"></div>
            <div style="display:flex; gap:10px;">
                <div class="input-group" style="flex:1;"><label>Pincode</label><input type="number" id="sPin" oninput="fetchCity(this.value, 'sCity')"></div>
                <div class="input-group" style="flex:1;"><label>Saher</label><input type="text" id="sCity" readonly placeholder="..."></div>
            </div>
            <div class="input-group"><label>Mobile No.</label><input type="number" id="sPhone"></div>
            <div class="input-group"><label>Salary Demand (‚Çπ)</label><input type="number" id="sSalary"></div>
            <button class="btn-main" onclick="registerUser('seeker')">PUBLISH & GENERATE ID ‚ú®</button>
        </div>

        <div id="employerSection" style="display:none;">
            <div id="empStep1">
                <div class="input-group"><label>Shop Name</label><input type="text" id="eShop" placeholder="Shop Name"></div>
                <div class="input-group"><label>Proper Address</label><textarea id="eAddress" rows="2" placeholder="Street, Area, Landmark"></textarea></div>
                <div style="display:flex; gap:10px;">
                    <div class="input-group" style="flex:1;"><label>Shop Pincode</label><input type="number" id="ePin" oninput="fetchCity(this.value, 'eCity')"></div>
                    <div class="input-group" style="flex:1;"><label>Saher</label><input type="text" id="eCity" readonly placeholder="..."></div>
                </div>
                <div class="input-group"><label>Contact No.</label><input type="number" id="ePhone" placeholder="10 Digit Number"></div>
                <button class="btn-main" onclick="registerUser('employer')">GENERATE SHOP ID ‚û°Ô∏è</button>
            </div>
            <div id="empStep2" style="display:none;">
                <div class="input-group"><label>Kaunsa Staff Chahiye?</label><input type="text" id="eSearchSkill" placeholder="e.g. Sales"></div>
                <div class="input-group"><label>Max Salary Budget (‚Çπ)</label><input type="number" id="eSearchSalary" placeholder="e.g. 15000"></div>
                <button class="btn-main" style="background:var(--success)" onclick="findStaff()">SEARCH MATCHING STAFF üîç</button>
                <div id="searchResults" style="margin-top: 15px;"></div>
            </div>
        </div>

        <div id="dashSection" style="display:none;">
            <div id="loginArea">
                <div class="input-group"><label>User ID / Shop ID</label><input type="text" id="loginUID" placeholder="ID-XXXX or SHOP-XXXX"></div>
                <div class="input-group"><label>Registered Mobile</label><input type="number" id="dashPhone"></div>
                <button class="btn-main" style="background:var(--success)" onclick="loadDashboard()">LOGIN TO PORTAL üìä</button>
            </div>
            <div id="dashContent" style="display:none;">
                <button class="logout-btn" onclick="logout()">Logout üö™</button>
                <div id="dashResults" style="margin-top:40px;"></div>
            </div>
        </div>

        <div id="id-card-display" class="animate__animated animate__zoomIn" style="display:none;">
            <div id="capture-area" class="id-box">
                <div style="font-size:10px; color:var(--primary); font-weight:900; letter-spacing: 2px;">ROZGAARIN OFFICIAL ID</div>
                <h3 id="id-disp-name" style="margin:20px 0 10px 0; font-size: 22px;"></h3>
                <div id="id-disp-uid" style="font-size:26px; color:var(--success); font-weight:900;"></div>
                <p id="id-disp-type" style="font-size:10px; margin-top:10px; opacity: 0.7;"></p>
                <div style="font-size: 8px; margin-top: 15px; opacity: 0.4;">SAVITRI ELECTRONICS PROJECT</div>
            </div>
            <button class="btn-main" onclick="downloadID()" style="background:#444;">SAVE ID TO GALLERY ‚¨áÔ∏è</button>
            <button class="btn-main" onclick="location.reload()" style="background:var(--success)">GOTO DASHBOARD</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyD3hc6Rz1gHZq8c71AHp5NSw8eSZT2-Mik", 
        authDomain: "savitri-job-bridge.firebaseapp.com", 
        projectId: "savitri-job-bridge", 
        storageBucket: "savitri-job-bridge.firebasestorage.app", 
        messagingSenderId: "721066136910", 
        appId: "1:721066136910:web:61b5d58b31d8ab481f7a1f" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    window.onload = () => {
        setTimeout(() => { document.getElementById('intro-overlay').style.display='none'; document.getElementById('main-content').style.display='block'; }, 1800);
        if(localStorage.getItem("rozgaarUID")) { switchTab('dash'); loadDashboard(true); }
    };

    function switchTab(t) {
        document.getElementById('seekerSection').style.display = t === 'seeker' ? 'block' : 'none';
        document.getElementById('employerSection').style.display = t === 'employer' ? 'block' : 'none';
        document.getElementById('dashSection').style.display = t === 'dash' ? 'block' : 'none';
        document.getElementById('id-card-display').style.display = 'none';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
        if(t==='seeker') document.getElementById('t1').classList.add('active-tab');
        if(t==='employer') document.getElementById('t2').classList.add('active-tab');
        if(t==='dash') document.getElementById('t3').classList.add('active-tab');
    }

    async function fetchCity(pin, tid) {
        if(pin.length === 6) {
            try {
                const res = await fetch(`https://api.postalpincode.in/pincode/${pin}`);
                const data = await res.json();
                if(data[0].Status === "Success") { document.getElementById(tid).value = data[0].PostOffice[0].District; }
            } catch(e) {}
        }
    }

    function registerUser(type) {
        const uid = (type === 'seeker' ? "ID-" : "SHOP-") + Math.floor(1000 + Math.random() * 9000);
        let data = { uid: uid, phone: type === 'seeker' ? document.getElementById('sPhone').value : document.getElementById('ePhone').value, type: type, dealStatus: "None" };
        
        if(type === 'seeker') {
            data.name = document.getElementById('sName').value;
            data.skill = document.getElementById('sSkill').value.toLowerCase();
            data.city = document.getElementById('sCity').value;
            data.salary = Number(document.getElementById('sSalary').value);
            data.status = "Available";
        } else {
            data.name = document.getElementById('eShop').value;
            data.address = document.getElementById('eAddress').value;
            data.pincode = document.getElementById('ePin').value;
            data.city = document.getElementById('eCity').value;
        }
        
        if(!data.name || !data.phone) return Swal.fire("Required fields fill karein!");

        db.collection("JobSeekers").add(data).then(() => {
            localStorage.setItem("rozgaarPhone", data.phone);
            localStorage.setItem("rozgaarUID", uid);
            localStorage.setItem("rozgaarType", data.type);
            
            document.getElementById('seekerSection').style.display = 'none';
            document.getElementById('employerSection').style.display = 'none';
            document.getElementById('tabNav').style.display = 'none';
            document.getElementById('brand-header').style.display = 'none';
            
            const idDisp = document.getElementById('id-card-display');
            idDisp.style.display = 'block';
            document.getElementById('id-disp-name').innerText = data.name;
            document.getElementById('id-disp-uid').innerText = uid;
            document.getElementById('id-disp-type').innerText = type.toUpperCase() + " ACCOUNT VERIFIED";
        });
    }

    async function loadDashboard(isAuto = false) {
        let ph = isAuto ? localStorage.getItem("rozgaarPhone") : document.getElementById('dashPhone').value;
        let uid = isAuto ? localStorage.getItem("rozgaarUID") : document.getElementById('loginUID').value;
        
        if(!ph || !uid) return;
        const snap = await db.collection("JobSeekers").where("phone", "==", ph).where("uid", "==", uid).get();
        if(snap.empty) return;
        
        const user = snap.docs[0].data();
        localStorage.setItem("rozgaarPhone", ph);
        localStorage.setItem("rozgaarUID", uid);

        document.getElementById('loginArea').style.display = 'none';
        document.getElementById('dashContent').style.display = 'block';
        
        let h = `<h3 style='margin-bottom:20px;'>Welcome, ${user.name} üëã</h3>`;
        
        if(user.type === 'seeker') {
            const snapOffer = await db.collection("JobSeekers").where("phone", "==", ph).get();
            snapOffer.forEach(doc => {
                const d = doc.data();
                if(d.hiredBy) {
                    h += `<div class="candidate-card">
                        <b>Shop: ${d.shopName || d.hiredBy}</b><br>
                        <small>üìç ${d.shopAddress || 'Local'}</small><br>
                        Status: <span style="color:orange">${d.dealStatus}</span><br>
                        ${d.dealStatus === 'Pending' ? `<button class="btn-main" onclick="updateDeal('${doc.id}', 'Accepted')">Accept</button>` : d.dealStatus === 'Accepted' ? `<a href="https://wa.me/91${d.employerPhone}" class="btn-main" style="display:block;text-align:center;text-decoration:none;background:#25D366;">WhatsApp Employer</a>` : ''}
                    </div>`;
                }
            });
        } else {
            document.getElementById('employerSection').style.display = 'none';
            document.getElementById('empStep2').style.display = 'block';
            
            const myReq = await db.collection("JobSeekers").where("hiredBy", "==", uid).get();
            h += `<h4>My Hiring Requests:</h4>`;
            myReq.forEach(doc => {
                const d = doc.data();
                h += `<div class="candidate-card">
                    <b>Staff: ${d.name}</b><br>Status: ${d.dealStatus}<br>
                    ${d.dealStatus === 'Accepted' ? `<a href="tel:${d.phone}" class="btn-main" style="display:block;text-align:center;text-decoration:none;">Call Staff üìû</a>` : `<small>Waiting...</small>`}
                </div>`;
            });
        }
        document.getElementById('dashResults').innerHTML = h || "No active deals found.";
    }

    async function findStaff() {
        const skill = document.getElementById('eSearchSkill').value.toLowerCase().trim();
        const maxSalary = Number(document.getElementById('eSearchSalary').value) || 999999;
        const resDiv = document.getElementById('searchResults');
        resDiv.innerHTML = "Searching...";
        
        const snap = await db.collection("JobSeekers").where("type", "==", "seeker").where("skill", "==", skill).get();
        let h = "";
        snap.forEach(doc => {
            const d = doc.data();
            if(d.salary <= maxSalary) {
                h += `<div class="candidate-card animate__animated animate__fadeInUp">
                    <b>${d.name}</b> | üìç ${d.city}<br>
                    Salary: ‚Çπ${d.salary}<br>
                    <button class="btn-main" onclick="requestHire('${doc.id}')" style="height:auto; padding:8px; font-size:12px;">Hire Staff</button>
                </div>`;
            }
        });
        resDiv.innerHTML = h || "No staff found.";
    }

    async function requestHire(id) {
        // Fetch Employer details from LocalStorage or Firestore
        const uid = localStorage.getItem("rozgaarUID");
        const snap = await db.collection("JobSeekers").where("uid", "==", uid).get();
        const emp = snap.docs[0].data();

        db.collection("JobSeekers").doc(id).update({
            hiredBy: uid,
            shopName: emp.name,
            shopAddress: emp.address + ", " + emp.city + " (" + emp.pincode + ")",
            employerPhone: localStorage.getItem("rozgaarPhone"),
            dealStatus: "Pending"
        }).then(() => { Swal.fire("Request Sent!"); loadDashboard(true); });
    }

    function updateDeal(id, status) {
        db.collection("JobSeekers").doc(id).update({ dealStatus: status }).then(() => loadDashboard(true));
    }

    function downloadID() {
        html2canvas(document.querySelector("#capture-area")).then(canvas => {
            const link = document.createElement('a');
            link.download = 'RozgaarIn-ID.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function logout() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
